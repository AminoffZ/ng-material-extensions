!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/table"),require("@angular/core"),require("file-saver"),require("xlsx")):"function"==typeof define&&define.amd?define("cdk-table-exporter",["exports","@angular/cdk/table","@angular/core","file-saver","xlsx"],e):e((t=t||self)["cdk-table-exporter"]={},t.ng.cdk.table,t.ng.core,t.fileSaver,t.xlsx)}(this,(function(t,e,r,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var c=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{declarations:[],imports:[e.CdkTableModule],exports:[]}]}],t}(),s={XLS:"xls",XLSX:"xlsx",CSV:"csv",TXT:"txt",JSON:"json",OTHER:"other"},p=function(t,e){this.extension=t,this.contentTypeHeader=e};var u=s.TXT+"/",f=".",l=f+s.XLS,d=f+s.XLSX,h=f+s.CSV,y=f+s.JSON,x=f+s.TXT,T=new p(l,"application/octet-stream;charset=utf-8"),g=new p(d,"application/octet-stream;charset=utf-8"),_=new p(y,u+JSON+";charset=utf-8"),b=new p(x,u+s.TXT+";charset=utf-16"),E=new p(h,u+s.CSV+";charset=utf-8"),v=".*."+s.XLS+"$",m=function(){function t(){}return t.save=function(t,e,r){var o=new Blob([t],{type:e.contentTypeHeader}),i="mat-table-exporter";r&&r.fileName&&(i=r.fileName),n.saveAs(o,i+e.extension)},t.isXls=function(t){return null!=t.toLowerCase().match(v)},t.identifyExportType=function(e){return e&&t.isXls(e)?s.XLS:s.XLSX},t.removeExtension=function(t){t.fileName=t.fileName.split(f)[0]},t}(),I=function(){function t(t,e,n,o,i){this.renderer=t,this.serviceLocator=e,this.dataExtractor=n,this.table=o,this.viewContainerRef=i,this.exportCompleted=new r.EventEmitter,this.exportStarted=new r.EventEmitter,this.initCdkTable()}return Object.defineProperty(t.prototype,"cdkTable",{get:function(){return this._cdkTable},set:function(t){console.warn("cdkTable input is deprecated!"),this._cdkTable=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exporterButton",{get:function(){return this._exporterButton},set:function(t){console.warn("exporterButton input is deprecated!"),this._exporterButton=t,this.setButtonListener()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fileName",{get:function(){return this._fileName},set:function(t){console.warn("fileName input is deprecated!"),this._fileName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheetName",{get:function(){return this._sheetName},set:function(t){console.warn("sheetName input is deprecated!"),this._sheetName=t},enumerable:!0,configurable:!0}),t.prototype.initCdkTable=function(){var t=this.viewContainerRef._data.componentView.component;if(t)this._cdkTable=t;else{if(!this.table)throw new Error("Unsupported Angular version");this._cdkTable=this.table}},t.prototype.initExporterService=function(t){t!==s.OTHER&&(this.exporter=this.serviceLocator.getService(t))},t.prototype.setButtonListener=function(){var t=this;this._exporterButton&&this.renderer.listen(this._exporterButton._elementRef.nativeElement,"click",(function(e){var r={fileName:t._fileName,sheet:t._sheetName};t.exportTable(m.identifyExportType(t._fileName),r)}))},t.prototype.exportTable=function(t,e){var r=this.correctExportType(t);this.initExporterService(r),this._options=e,this.exportStarted.emit(),this._isIterating=!0,this._isExporting=!0,this._data=new Array,this.enableExportButton(!1),this.extractTableHeader();try{this.exportWithPagination()}catch(t){this.exportSinglePage()}},t.prototype.correctExportType=function(t){if(!t||"string"!=typeof t)return t;switch(t){case s.CSV:return s.CSV;case s.JSON:return s.JSON;case s.OTHER:return s.OTHER;case s.TXT:return s.TXT;case s.XLS:return s.XLS;case s.XLSX:return s.XLSX}},t.prototype.exportWithPagination=function(){this._initialPageIndex=this.getCurrentPageIndex(),this.initPageHandler(),this.goToPage(0)},t.prototype.exportSinglePage=function(){this.extractDataOnCurrentPage(),this.extractTableFooter(),this.exportExtractedData()},t.prototype.extractDataOnCurrentPage=function(){this._data=this._data.concat(this.dataExtractor.extractRows(this._cdkTable,this.hiddenColumns))},t.prototype.initPageHandler=function(){var t=this;this._subscription||(this._subscription=this.getPageChangeObservable().subscribe((function(){setTimeout((function(){t._isIterating?(t.extractDataOnCurrentPage(),t.hasNextPage()?t.nextPage():(t._isIterating=!1,t.goToPage(t._initialPageIndex))):t._isExporting&&(t._isExporting=!1,t.extractTableFooter(),t.exportExtractedData())}))})))},t.prototype.exportExtractedData=function(){this.exporter.export(this._data,this._options),this._data=new Array,this.enableExportButton(!0),this.exportCompleted.emit()},t.prototype.extractSpecialRow=function(t){var e=this.dataExtractor.extractRow(this._cdkTable,this.hiddenColumns,t);e&&this._data.push(e)},t.prototype.extractTableHeader=function(){this.extractSpecialRow(this._cdkTable._headerRowOutlet)},t.prototype.extractTableFooter=function(){this.extractSpecialRow(this._cdkTable._footerRowOutlet)},t.prototype.hasNextPage=function(){return this.getCurrentPageIndex()<this.getPageCount()-1},t.prototype.nextPage=function(){this.goToPage(this.getCurrentPageIndex()+1)},t.prototype.enableExportButton=function(t){this._exporterButton&&this.renderer.setProperty(this._exporterButton._elementRef.nativeElement,"disabled",t?null:"true")},t.propDecorators={hiddenColumns:[{type:r.Input}],exporter:[{type:r.Input}],exportCompleted:[{type:r.Output}],exportStarted:[{type:r.Output}],cdkTable:[{type:r.Input}],exporterButton:[{type:r.Input}],fileName:[{type:r.Input}],sheetName:[{type:r.Input}]},t}();var S=function(){function t(){}return t.prototype.export=function(t,e){var r=JSON.stringify(t);m.save(r,_,e)},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),w=function(){function t(){}return t.prototype.export=function(t,e){if(!t)throw new Error("Empty json array is provided, rows parameter is mandatory!");var r=o.utils.json_to_sheet(t,{skipHeader:!0});this.writeToFile(r,e)},t.prototype.writeToFile=function(t,e){var r=this.createContent(t,e),n=this.getMimeType();m.save(r,n,e)},t}();var X=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){return o.utils.sheet_to_txt(t)},e.prototype.getMimeType=function(){return b},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(w),N=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){var r=o.utils.book_new();return e||(e={}),this.correctType(e),o.utils.book_append_sheet(r,t,e.sheet),o.write(r,e)},e.prototype.getMimeType=function(){return T},e.prototype.correctType=function(t){t.type||(t.type="array")},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(w),C=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getMimeType=function(){return g},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(N),P=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){return o.utils.sheet_to_csv(t)},e.prototype.getMimeType=function(){return E},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(w),O=function(){function t(t){this.injector=t}return t.prototype.getService=function(t){switch(t){case s.XLS:return this.injector.get(N);case s.XLSX:return this.injector.get(C);case s.JSON:return this.injector.get(S);case s.TXT:return this.injector.get(X);case s.CSV:return this.injector.get(P);default:return this.injector.get(C)}},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.Injector}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(r.INJECTOR))},token:t,providedIn:"root"}),t}();var j=function(){function t(){}return t.prototype.extractRows=function(t,e){return this.getRowsAsJsonArray(t,e,t._rowOutlet)},t.prototype.extractRow=function(t,e,r){return this.getRowsAsJsonArray(t,e,r)[0]},t.prototype.getRowsAsJsonArray=function(t,e,r){var n=this.getRenderedRows(t,r);return this.convertToJsonArray(e,n)},t.prototype.getRenderedRows=function(t,e){return t._getRenderedRows(e)},t.prototype.convertToJsonArray=function(t,e){for(var r=new Array,n=0;n<e.length;n++){var o=this.convertRow(t,e[n]);r.push(this.createExcelItem(o))}return r},t.prototype.convertRow=function(t,e){for(var r=new Array,n=e.children,o=0;o<n.length;o++)if(!this.shouldHide(t,o)){var i=n.item(o).innerText;r.push(i)}return r},t.prototype.shouldHide=function(t,e){return!(!t||!t.includes(e))},t.prototype.createExcelItem=function(t){return Object.assign({},t)},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();t.CHAR_SET_UTF=";charset=utf-",t.CHAR_SET_UTF_16=";charset=utf-16",t.CHAR_SET_UTF_8=";charset=utf-8",t.CONTENT_TYPE_APPLICATION="application/",t.CONTENT_TYPE_EXCEL="application/octet-stream",t.CONTENT_TYPE_TEXT=u,t.CdkTableExporter=I,t.CdkTableExporterModule=c,t.CsvExporterService=P,t.DataExtractorService=j,t.EXTENSION_CSV=h,t.EXTENSION_JSON=y,t.EXTENSION_TEXT=x,t.EXTENSION_XLS=l,t.EXTENSION_XLSX=d,t.ExportType=s,t.FileUtil=m,t.JsonExporterService=S,t.MAT_TABLE_EXPORTER="mat-table-exporter",t.MIME_CSV=E,t.MIME_EXCEL_XLS=T,t.MIME_EXCEL_XLSX=g,t.MIME_JSON=_,t.MIME_TXT=b,t.Mime=p,t.P=f,t.REF="!ref",t.ServiceLocatorService=O,t.TYPE_ARRAY="array",t.TxtExporterService=X,t.WorksheetExporter=w,t.XLS_REGEX=v,t.XlsExporterService=N,t.XlsxExporterService=C,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=cdk-table-exporter.umd.min.js.map